---
/**
 * Astro component that renders a table with search and optional filtering capabilities.
 * Uses vanilla JavaScript for client-side interactivity. Supports URL state management for search/filter params.
 *
 * @param headers: array.<{id:string, name:string, filter_by:boolean}> - header/field info.
 *   - id: must be unique in the array. must match a key in "data" object
 *   - name: field/header display name
 *   - filter_by: (optional) if true, creates a filter dropdown and enables filtering for that field.
 * @param data: array.<object> - table details. each key in the object must match a unique id in the "headers" array.
 * @param resource: (optional) string - path to JSON file with multifiltersearch data structure
 *
 * @example
 * // Using props directly:
 * <Multi
 *   headers={[
 *     { id: 'name', name: 'Name', filter_by: false },
 *     { id: 'category', name: 'Category', filter_by: true },
 *     { id: 'description', name: 'Description', filter_by: false }
 *   ]}
 *   data={[
 *     { name: 'Item 1', category: 'Type A', description: 'Description 1' },
 *     { name: 'Item 2', category: 'Type B', description: 'Description 2' }
 *   ]}
 * />
 *
 * // Using a resource file:
 * <Multi resource="data/my-data.json" />
 *
 * // JSON structure for resource file:
 * {
 *   "multifiltersearch": {
 *     "headers": [...],
 *     "data": [...]
 *   }
 * }
 * // Or simplified:
 * {
 *   "headers": [...],
 *   "data": [...]
 * }
 */

type Props = {
resource: string;
fm_resource: {
    headers: {
        id: string;
        name: string;
        filter_by: boolean;
    }[];
    data: Record<string, any>[];
};
}

const { resource, fm_resource } = Astro.props;
const { pathname } = Astro.url;
console.log("FM_RESOURCE",fm_resource);

// Fail early if no data source found
if(!fm_resource.headers.length && !fm_resource.data.length && !resource) {
    throw new Error(`No data source provided for multifiltersearch component in file: ${pathname}`);
}

// Initialize headers and data variables
let headers:Props['fm_resource']['headers'] | [] = []
let data:Props['fm_resource']['data'] = []

if(fm_resource && !resource) {
    // Get frontmatter dataset
    headers = fm_resource.headers;
    data = fm_resource.data;
} else if(resource && !fm_resource.headers.length && !fm_resource.data.length) {
    // Get JSON dataset
    const resourcePath = `../data/${resource}.json`;
    const jsonFiles = await import.meta.glob(`../data/*.json`, { eager: true });
    const jsonFile: any = Object.entries(jsonFiles).find(
      (file) => file[0] === resourcePath
    )
    if(!jsonFile) {
        throw new Error(`No data source found for resource param: ${resource} in file: ${pathname}`);
    }
    const jsonData = jsonFile[1].default;
    headers = jsonData.multifiltersearch.headers;
    data = jsonData.multifiltersearch.data;
    
}
console.log("JSON DATA",headers, data);